scripted_gui = {
    sphere_relations = {
        window_name = "modrelations_info"
		context_type = selected_country_context
		parent_window_token = selected_country_view_diplomacy 

		#visible = { has_variable = sphere_owner}
        visible = {always = yes}

        triggers = {
            flag_visible = {
                has_variable = sphere_owner
            }
            small_flag_frame_thin_visible = {
                has_variable = sphere_owner
            }
        }

        properties = {
            relation_icon = {
                image = "[sphere_status_icon]"
            }
            flag = {
                image = "[?sphere_owner.GetFlag]"
            }
        }
    }

    toggle_sphere_status = {
        window_name = "modrelation_container"
		context_type = selected_country_context
		parent_window_token = selected_country_view_diplomacy

		visible = { check_variable = { sphere_members^num > 0 }}
        #visible = {always = yes}

        properties = {
            flag = {
                image = "[THIS.GetFlag]"
            }
        }
		
        dynamic_lists = {
            relation_flags = {
                array = sphere_members
				entry_container = sphere_flag_entry
                change_scope = yes
            }
        }
    }

    release_autonomy = {
        window_name = "release_autonomy"
		context_type = selected_state_context
		parent_window_name = province_info_window

        visible = {
            controller = {tag = ROOT}
            if = {
                limit = {check_variable = {core_countries^num > 1}}
                always = yes
            }
            else = {
                NOT = {check_variable = {core_countries^0 = ROOT}}
            }
        }

        effects = {
            r_click = {
                for_each_scope_loop = {
                    array = core_countries
                    break = b
                    
                    if = {
                        limit = {
                            NOT = {tag = ROOT}
                            OR = {
                                NOT = {country_exists = THIS}
                                AND = {
                                    is_subject_of = ROOT
                                    OR = {
                                        has_autonomy_state = autonomy_autonomy
                                        has_autonomy_state = autonomy_subject
                                    }
                                }
                            }
                        }
                        transfer_state = PREV
                        set_country_flag = autonomy_state
                        ROOT = {
                            set_autonomy = {
                                target = PREV
                                autonomy_state = autonomy_autonomy
                                end_wars = no
                                end_civil_wars = no
                            }
                        }
                        
                        set_temp_variable = { b = 1 }
                    }
                }
                encount_minors = yes
            }
        }
    }
}