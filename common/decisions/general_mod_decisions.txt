
nuclear_war = {
	NukeRequest = {
		visible = {
			is_in_faction = yes
			has_war = yes
			num_of_nukes > 0
			is_faction_leader = no
		}
		available = {
			not = {has_country_flag = nuke_request_accepted}
		}

        days_re_enable = 30

		complete_effect = {
			ROOT = {
				faction_leader = {
					country_event = {id = nukemod.1 days = 1}
				}
			}
		}

        ai_will_do = {
            base = 0
            modifier = {
                num_of_nukes > 0
                add = 100
            }
            modifier = {
                surrender_progress < 0.1
                add = -100
            }
            modifier = {
                surrender_progress < 0.3
                add = -50
            }
            modifier = {
                has_war_with_major = no
                add = -100
            }
            modifier = {
                surrender_progress > 0.5
                add = 300
            }
            modifier = {
                has_country_flag = been_nuked
                add = 10000
            }
        }
	}
}

nuclear_construction = {
	NukeConstruct = {
		visible = {always = yes}
		available = {
			num_of_civilian_factories_available_for_projects > 2
            
            custom_trigger_tooltip = {
				tooltip = nuclear_construction_conditions
				check_variable = {
					resource@uranium > 1
				}
            }
		}

		days_remove = 360

        custom_cost_trigger = {
            num_of_civilian_factories_available_for_projects > 2
        }
        custom_cost_text = nuclear_construction_factories

        modifier = {
            civilian_factory_use = 2
        }

        complete_effect = {
            hidden_effect = {
                set_variable = {ndelay = 360}
                set_variable = {num_of_reactors = 0}
                every_owned_state = {
                    owner = {add_to_variable = {num_of_reactors = PREV.building_level@nuclear_reactor}}
                }
                set_variable = {uranium_has = resource@uranium}
                set_variable = {urr = 0}

                divide_variable = {uranium_has = uranium_cost}
                if = {
                    limit = {
                        check_variable = {uranium_has < num_of_reactors}
                    }
                    set_variable = {urr = uranium_has}
                }
                else = {
                    set_variable = {urr = num_of_reactors}
                }

                divide_variable = {ndelay = urr}
                set_variable = {remove_days_ur = 360}
                subtract_from_variable = {remove_days_ur = ndelay}
                multiply_variable = {remove_days_ur = -1}

                country_event = {id = nukemod.2 days = 1}
            }
            custom_effect_tooltip = nuclear_construction_tip
        }

        remove_effect = {
            add_nuclear_bombs = 1
        }

	}
}

foreign_support = {
	economic_friend_support = {
		visible = {
			is_in_faction = yes
			not = {has_idea = ec_fs_l_b}
			not = {has_idea = ec_fs_m_b}
			not = {has_idea = ec_fs_h_b}
			FROM = {
                OWNER = {
				    is_in_faction_with = ROOT
                    NOT = {tag = ROOT}
                }
			}
		}

		target_trigger = {
			FROM = {
                is_capital = yes
                if = {
                    limit = {is_capital = yes}
                    OWNER = {
                        is_in_faction_with = ROOT
                    }
                }
			}
		}

        state_target = yes
        on_map_mode = map_only

		complete_effect = {
			ROOT = {
				add_timed_idea = {idea = ec_fs_h_b days = 120}
			}
			FROM = {
                OWNER = {
				    add_timed_idea = {idea = ec_fs_h_g days = 120}
                }
			}
		}

		ai_will_do = {
			factor = 0
			modifier = {
				factor = 1
				set_temp_variable = {raznica_economic_friends = ROOT.world_influence}
				subtract_from_temp_variable = {raznica_economic_friends = FROM.world_influence}
				check_variable = {raznica_economic_friends > 4}
				check_variable = {world_influence > 5}
				has_war = no
				has_stability > 0.5
			}
		}
	}
}

war_measures = {
	tension_demonstration = {
		available = {
			has_war = yes
		}
		visible = {
			has_war = yes
			always = no
		}

		target_trigger = {
			FROM = {
				not = {has_war_with = ROOT}
				is_neighbor_of = ROOT
			}
		}

		custom_cost_trigger = {
			has_army_experience > 10
			command_power > 15
		}

		days_remove = 90

		complete_effect = {
			army_experience = -10
			add_command_power = -15
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = 1000
				}
			}
		}

		remove_effect = {
			FROM = {
				add_ai_strategy = {
					type = prepare_for_war
					id = ROOT
					value = 50
				}
			}
		}
	}
}

foreign_influence = {

	make_loyal = {
		available = {
			OR = {
				has_government = monarchism
				has_government = neutrality
			}
		}
		visible = {
			OR = {
				has_government = monarchism
				has_government = neutrality
			}
		}

		target_trigger = {
			FROM = {
				is_subject_of = ROOT
				not = {
					OR = {
						has_government = monarchism
						has_government = neutrality
					}
				}
			}
		}

		fire_only_once = yes

		custom_cost_trigger = {
			command_power > 30
		}

		complete_effect = {
			add_command_power = -30
			FROM = {
				set_politics = {
					ruling_party = neutrality
					elections_allowed = no
				}
				set_popularities = {
					monarchism = 0
					democratic = 30
					neutrality = 70
					fascism = 0
					communism = 0
				}
				set_country_leader_ideology = conservatism
			}
		}

		ai_will_do = {
			factor = 1
		}
	}
}

political_actions = {

    change_politform = {
        days_remove = change_pf_cost

        modifier = {
            stability_weekly = -0.002
        }

        remove_effect = {
            add_to_array = { modalerts = 1 }
            add_to_array = { modalerts_data = 0 }
            set_country_flag = {flag = politform_change_available value = 1 days = 30}
            country_event = {id = onactev.15 days = 30}
        }
    }

	left_pressure = {
		available = {
			has_government = democratic
			
			has_country_leader_ideology = centrism
		}
		visible = {
			has_government = democratic
		}

		cost = 25

		days_remove = 120

		complete_effect = {
			add_stability = 0.105
			add_ideas = left_pressuring
		}

		remove_effect = {
			add_stability = -0.1
			remove_ideas = left_pressuring
		}

		ai_will_do = {
			factor = 0.5
		}
	}
	right_pressure = {
		available = {
			has_government = democratic
			has_country_leader_ideology = centrism
		}
		visible = {
			has_government = democratic
		}

		cost = 25

		days_remove = 120

		complete_effect = {
			add_stability = 0.105
			add_war_support = -0.05
		}

		remove_effect = {
			add_stability = -0.1
			add_war_support = 0.05
		}

		ai_will_do = {
			factor = 0.5
		}
	}

	support_elite = {
		available = {
			has_government = monarchism
		}
		visible = {
			has_government = monarchism
		}

		cost = 15

		days_remove = 90

		complete_effect = {
			add_ideas = elite_supporting
			add_stability = -0.05
		}

		remove_effect = {
			remove_ideas = elite_supporting
			add_stability = 0.05
		}

		ai_will_do = {factor = 0.6}
	}

	support_workers = {
		available = {
			has_government = monarchism
		}
		visible = {
			has_government = monarchism
		}

		cost = 15

		days_remove = 90

		complete_effect = {
			add_ideas = workers_supporting
			add_stability = 0.05
		}

		remove_effect = {
			remove_ideas = workers_supporting
			add_stability = -0.05
		}

		ai_will_do = {factor = 0.5}
	}

	rise_central_power = {
		available = {
			has_government = neutrality
		}
		visible = {
			has_government = neutrality
		}

		cost = 15
		days_re_enable = 90

		complete_effect = {
			add_popularity = {
				ideology = democratic
				popularity = -0.01
			}
		}

		ai_will_do = {factor = 1}
	}

	rosguardy = {
		available = {
			has_government = neutrality
		}
		visible = {
			has_government = neutrality
		}

		cost = 15

		days_re_enable = 90

		complete_effect = {
			add_stability = 0.01
		}

		ai_will_do = {factor = 1}
	}

	parade = {
		available = {
			has_government = neutrality
		}
		visible = {
			has_government = neutrality
		}

		cost = 15

		days_re_enable = 90

		complete_effect = {
			add_war_support = 0.01
		}

		ai_will_do = {factor = 1}
	}

	military_civilians = {
		available = {
			has_government = fascism
			check_variable = {trained_civs_num < 10}
		}
		visible = {
			has_government = fascism
		}

		cost = 15

		days_re_enable = 120

		complete_effect = {
			add_manpower = 10000
			army_experience = 2
			add_to_variable = {trained_civs_num = 1}
		}

		ai_will_do = {factor = 1}
	}

	movie_propoganda = {
		available = {
			has_government = fascism
		}
		visible = {
			has_government = fascism
		}

		cost = 15

		fire_only_once = yes

		complete_effect = {
			add_popularity = {
				ideology = fascism
				popularity = 0.05
			}
		}

		ai_will_do = {factor = 1}
	}

	military_gov_trade = {
		available = {
			has_government = fascism
		}
		visible = {
			has_government = fascism
		}

		cost = 15

		fire_only_once = yes

		complete_effect = {
			add_equipment_to_stockpile = {
			    type = infantry_equipment
			    amount = 5000
			    producer = ROOT
			}
			add_stability = -0.1
		}

		ai_will_do = {
			factor = 0
			modifier = {
				factor = 1
				has_stability > 7
			}
		}
	}

	update_work_plan = {
		available = {
			has_government = communism
		}
		visible = {
			has_government = communism
		}

		cost =50

		days_remove = 90
		days_re_enable = 1080

		complete_effect = {
			add_ideas = updated_work_plan
		}

		remove_effect = {
			remove_ideas = updated_work_plan
		}

		ai_will_do = {factor = 1}
	}

}

sphere_category = {
    sphere_take_resources_oil = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = oil amount > 0 }
                
			}
            
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 75

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 75
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { oil }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    sphere_take_resources_steel = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = steel amount > 0 }
                #NOT = {has_state_flag = sphere_resources_used}
			}
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 75

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 75
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { steel }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    sphere_take_resources_aluminium = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = aluminium amount > 0 }
                #NOT = {has_state_flag = sphere_resources_used}
			}
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 75

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 75
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { aluminium }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    sphere_take_resources_chromium = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = chromium amount > 0 }
                #NOT = {has_state_flag = sphere_resources_used}
			}
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 75

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 75
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { chromium }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    sphere_take_resources_tungsten = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = tungsten amount > 0 }
                #NOT = {has_state_flag = sphere_resources_used}
			}
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 75

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 75
                
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { tungsten }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    sphere_take_resources_uranium = {

        target_trigger = {
			FROM = {
                var:OWNER = {check_variable = { sphere_owner = ROOT }}

                has_resources_amount = { resource = uranium amount > 0 }
                #NOT = {has_state_flag = sphere_resources_used}
			}
		}
        
        state_target = yes
        on_map_mode = map_only

        cost = 100

        days_remove = 180
        complete_effect = {
            FROM.OWNER = {
                add_political_power = 100
                give_resource_rights = {
                    receiver = ROOT
                    state = FROM
                    resources = { uranium }
                }
            }
            FROM = {set_state_flag = sphere_resources_used}
        }
        remove_effect = {
            remove_resource_rights = FROM
            FROM = {clr_state_flag = sphere_resources_used}
        }
    }

    #sphere_debuff = {
    #    targets = {sphere_owner}

        #days_mission_timeout = 0
        
        #available = {always = no}
        #activation = {
        #    has_variable = sphere_owner
        #}
        #days_remove = -1

        #targeted_modifier = {
        #    tag = FROM
        #    trade_cost_for_target_factor = -0.5
        #    extra_trade_to_target_factor = 0.5
            #mic_to_target_factor = 0.05
        #    attack_bonus_against_cores = 0.05
        #    defense_bonus_against = -0.25
        #}


    #}

    sphere_buy_infantry = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    infantry_equipment > 1000
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = infantry_equipment
                    amount = 1000
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_extra = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    support_equipment > 300
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = support_equipment
                    amount = 300
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_artillery = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    artillery_equipment > 50
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = artillery_equipment
                    amount = 50
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_anti_tank = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    anti_tank_equipment > 50
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = anti_tank_equipment
                    amount = 50
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_anti_air = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    anti_air_equipment > 50
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = anti_air_equipment
                    amount = 50
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_trucks = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    motorized_equipment > 100
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = motorized_equipment
                    amount = 100
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_mechanized = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 30
		}
		hidden_effect = {
			add_command_power = -30
		}
		custom_cost_text = decision_cost_CP_30

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    mechanized_equipment > 100
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = mechanized_equipment
                    amount = 100
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 10
			}
        }
    }

    sphere_buy_fighters = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 40
		}
		hidden_effect = {
			add_command_power = -40
		}
		custom_cost_text = decision_cost_CP_40

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    fighter_equipment > 10
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = fighter_equipment
                    amount = 10
                    target = PREV
                }
            }
			FROM = {
				army_experience = 5
				add_command_power = 15
			}
        }
    }

    sphere_buy_cas = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 40
		}
		hidden_effect = {
			add_command_power = -40
		}
		custom_cost_text = decision_cost_CP_40

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    CAS_equipment > 10
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = CAS_equipment
                    amount = 10
                    target = PREV
                }
            }
			FROM = {
				army_experience = 5
				add_command_power = 15
			}
        }
    }

    sphere_buy_trains = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 20
		}
		hidden_effect = {
			add_command_power = -20
		}
		custom_cost_text = decision_cost_CP_20

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    train_equipment > 5
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = train_equipment
                    amount = 5
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_convoys = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 15
		}
		hidden_effect = {
			add_command_power = -15
		}
		custom_cost_text = decision_cost_CP_15

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    convoy > 25
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = convoy
                    amount = 25
                    target = PREV
                }
            }
			FROM = {
				army_experience = 1
				add_command_power = 5
			}
        }
    }

    sphere_buy_tanks = {
        cost = 15
		
		custom_cost_trigger = {
			command_power > 30
		}
		hidden_effect = {
			add_command_power = -30
		}
		custom_cost_text = decision_cost_CP_30

        #days_re_enable = 30

        target_array = sphere_members
        targets = {sphere_owner}

        visible = {
            FROM = {
                has_equipment = {
                    modern_tank_equipment > 25
                }
                if = {
                    limit = {ROOT = {check_variable = { sphere_owner = FROM }}}
                    has_country_flag = allow_export_eq_@ROOT
                }
            }
        }

        complete_effect = {
            FROM = {
                send_equipment = {
                    equipment = modern_tank_equipment
                    amount = 25
                    target = PREV
                }
            }
			FROM = {
				army_experience = 5
				add_command_power = 15
			}
        }
    }

    sphere_ask_export = {
        cost = 15

        #days_re_enable = 30
        targets = {sphere_owner}

        visible = {
            FROM = {
                NOT = {has_country_flag = allow_export_eq_@ROOT}
            }
        }

        complete_effect = {
            FROM = {
                country_event = {id = mechanics.41 days = 1}
            }
        }
    }

    sphere_allow_export = {
        #days_re_enable = 30
        target_array = sphere_members

        priority = 1000

        visible = {
            NOT = {has_country_flag = allow_export_eq_@FROM}
        }

        complete_effect = {
            set_country_flag = allow_export_eq_@FROM
            set_temp_variable = { temp = FROM }
            custom_effect_tooltip = allow_export_eq_tt
        }
    }
    sphere_cancel_export = {
        #days_re_enable = 30
        target_array = sphere_members

        priority = 1000

        visible = {
            has_country_flag = allow_export_eq_@FROM
        }

        complete_effect = {
            clr_country_flag = allow_export_eq_@FROM
            set_temp_variable = { temp = FROM }
            custom_effect_tooltip = cancel_export_eq_tt
        }
    }

}

escalation_category = {
    #_esc_blank = {
    #    visible = {has_variable = escalation_member}
        #allowed = {always = no}
    #}

    esc_timer = {
        available = {always = no}
        activation = {has_variable = escalation_member NOT = {has_country_flag = escaltion_timeout}}

        is_good = no

        days_mission_timeout = 90
        priority = 1000

        timeout_effect  = {
            hidden_effect = {
                set_country_flag = escalation_timeout
                every_country = {
                    limit = {check_variable = { escalation_member = ROOT.escalation_member }}
                    if = {
                        limit = {has_country_flag = escalation_timeout}
                        add_to_temp_variable = { timeouts = 1 }
                    }
                    add_to_temp_variable = { all_escalators = 1 }
                }
                if = {
                    limit = {check_variable = { timeouts = all_escalators }}
                    escalation_stop = yes
                }
            }
        }
    }

    esc_demand_requirements = {
        targets = {
            escalation_friend
        }

        visible = {has_variable = escalation_member}
        available = {
            NOT = {has_country_flag = escalation_timeout}
            
            set_temp_variable = { temp = 0 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        days_re_enable = 30

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 5
                tooltip=escalation_hotness_change_tooltip
            }

            escalation_decision_effect = yes
        }
    }

    esc_embargo = {
        target_trigger = {
            FROM = {
                check_variable = { escalation_member = ROOT.escalation_member }
                if = {
                    limit = {ROOT = {has_country_flag = escalation_on_sender}}
                    has_country_flag = escalation_on_to
                }
                else = {
                    has_country_flag = escalation_on_sender
                }
            }
            NOT = {is_embargoing = FROM}
        }

        remove_trigger = {
            NOT = {has_variable = escalation_member}
        }

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 24 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 8
                tooltip=escalation_hotness_change_tooltip
            }

            send_embargo = FROM
            

            escalation_decision_effect = yes
        }

        days_remove = 90

        remove_effect = {
            break_embargo = FROM
        }
    }

    esc_guarantee = {
        target_trigger = {
            FROM = {
                check_variable = { escalation_member = ROOT.escalation_member }
                if = {
                    limit = {ROOT = {has_country_flag = escalation_on_sender}}
                    has_country_flag = escalation_on_sender
                }
                else = {
                    has_country_flag = escalation_on_to
                }
            }
            NOT = {has_guaranteed = FROM}
        }

        remove_trigger = {
            NOT = {has_variable = escalation_member}
        }

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 40 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 12
                tooltip=escalation_hotness_change_tooltip
            }

            give_guarantee = FROM
            

            escalation_decision_effect = yes
        }

        days_remove = 90

        remove_effect = {
            diplomatic_relation = {
                country = FROM
                relation = guarantee
                active = no
            }
        }
    }

    esc_close_diplomacy = {
        target_trigger = {
            FROM = {
                check_variable = { escalation_member = ROOT.escalation_member }
                if = {
                    limit = {ROOT = {has_country_flag = escalation_on_sender}}
                    has_country_flag = escalation_on_to
                }
                else = {
                    has_country_flag = escalation_on_sender
                }
            }
        }

        remove_trigger = {
            NOT = {has_variable = escalation_member}
        }

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 50 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 8
                tooltip=escalation_hotness_change_tooltip
            }

            set_country_flag = closed_diplomacy_@FROM
            custom_effect_tooltip = close_diplomacy_tooltip

            escalation_decision_effect = yes
        }

        days_remove = 120

        remove_effect = {
            clr_country_flag = closed_diplomacy_@FROM
            custom_effect_tooltip = open_diplomacy_tooltip
        }
    }

    esc_osuzhdayu_maximalno = {
        targets = {escalation_enemy}

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 15 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        days_re_enable = 30

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 5
                tooltip=escalation_hotness_change_tooltip
            }

            escalation_decision_effect = yes
        }
    }

    esc_exile_embassy = {
        targets = {escalation_enemy}

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 50 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        fire_only_once = yes

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 10
                tooltip=escalation_hotness_change_tooltip
            }

            escalation_decision_effect = yes
        }
    }

    esc_spys = {

        visible = {
            has_variable = escalation_member
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 5 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        remove_trigger = {
            NOT = {has_variable = escalation_member}
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > 14.9 }
        }
        custom_cost_text = decision_cost_flat_15

        complete_effect = {
            hidden_effect = {
                add_to_variable = {escalation_score = -15}   
            }

            add_to_variable = {
                var = escalation_member:escalation_hotness
                value = 3
                tooltip=escalation_hotness_change_tooltip
            }

            escalation_decision_effect = yes
        }

        days_remove = 30

        modifier = {
            intel_network_gain_factor = 0.2
            operation_outcome = 0.15
        }
    }

    esc_war = {

        visible = {
            has_variable = escalation_member
            var:escalation_member = {NOT = {has_country_flag = escalation_war_start}}
        }
        available = {
            NOT = {has_country_flag = escalation_timeout}
            set_temp_variable = { temp = 90 }
            custom_trigger_tooltip = {
                var:escalation_member = {check_variable = { escalation_hotness > temp }}
                tooltip = has_escalation_hotness
            }
        }

        custom_cost_trigger = {
            check_variable = { escalation_score > escalation_war_score }
        }
        custom_cost_text = decision_cost_flat_esc_war

        complete_effect = {
            hidden_effect = {
                subtract_from_variable = {escalation_score = escalation_war_score}   
                var:escalation_member = {set_country_flag = escalation_war_start}
            }
        }

        days_remove = 30
        war_with_on_remove = escalation_enemy
        
        remove_effect = {
            declare_war_on = {
                target = escalation_enemy
                type = puppet_wargoal_focus
            }

            if = {
                limit = {has_country_flag = escalation_on_sender}
                set_temp_variable = { sender_gang = THIS }
                set_temp_variable = { to_gang = escalation_enemy }
            }
            else = {
                set_temp_variable = { to_gang = THIS }
                set_temp_variable = { sender_gang = escalation_enemy }
            }

            hidden_effect = {
                var:escalation_member = {clr_country_flag = escalation_war_start}
                every_other_country = {
                    limit = {
                        check_variable = { escalation_member = ROOT.escalation_member }
                    }
                    set_temp_variable = { this_scope = THIS }
                    if = {
                        limit = {
                            has_country_flag = escalation_on_sender
                        }
                        var:sender_gang = {
                            var:to_gang = {
                                var:this_scope = {
                                    add_to_war = {
                                        targeted_alliance = PREV.PREV
                                        enemy = PREV
                                    }
                                }
                            }
                        }
                    }
                    else = {
                        var:sender_gang = {
                            var:to_gang = {
                                var:this_scope = {
                                    add_to_war = {
                                        targeted_alliance = PREV
                                        enemy = PREV.PREV
                                    }
                                }
                            }
                        }
                    }
                }

                
                escalation_stop = yes
            }
            
        }
    }

}